<!doctype html>
<html lang="en" th:replace="base::layout(~{::main})">

<head>

</head>

<body>
    <main style="padding-bottom: 120px;">
        <!-- Main Content Placeholder -->


        <!-- Best Selling Products -->
        <section class="best-selling container mt-1">
            <h2 class="text-center fw-bold my-3 mt-5"
                th:text="${category != null ? category.categoryName : (query != null ? #strings.concat('Results for: ', query) : '')}"></h2>
                <div class="d-flex mb-3">
                <!-- Sort By Filter -->
                <div class="dropdown me-3">
                    <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="sortBy" data-bs-toggle="dropdown" aria-expanded="false">
                        Sort by
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="sortByDropdown">
                        <li>
                            <!-- Sort by Low to High Price -->
                            <a class="dropdown-item" th:href="@{/products(sortBy='priceAsc', query=${param.query}, categoryId=${param.categoryId}, color=${param.color})}">
                                Low to High Price
                            </a>
                        </li>
                        <li>
                            <!-- Sort by High to Low Price -->
                            <a class="dropdown-item" th:href="@{/products(sortBy='priceDesc', query=${param.query}, categoryId=${param.categoryId}, color=${param.color})}">
                                High to Low Price
                            </a>
                        </li>
                    </ul>
                </div>

                <div class="dropdown me-3">
                    <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="discountFilter" data-bs-toggle="dropdown" aria-expanded="false">
                        Discount
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="discountFilterDropdown">
                        <li>
                            <a class="dropdown-item" th:href="@{/products(minDiscount=0, maxDiscount=10, query=${param.query}, categoryId=${param.categoryId}, sortBy=${param.sortBy}, color=${param.color})}">
                                0% - 10% Off
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" th:href="@{/products(minDiscount=10, maxDiscount=20, query=${param.query}, categoryId=${param.categoryId}, sortBy=${param.sortBy}, color=${param.color})}">
                                10% - 20% Off
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" th:href="@{/products(minDiscount=20, maxDiscount=30, query=${param.query}, categoryId=${param.categoryId}, sortBy=${param.sortBy}, color=${param.color})}">
                                20% - 30% Off
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" th:href="@{/products(minDiscount=30, maxDiscount=100, query=${param.query}, categoryId=${param.categoryId}, sortBy=${param.sortBy}, color=${param.color})}">
                                30% Off and Above
                            </a>
                        </li>
                    </ul>
                </div>
        
                <!-- Color Filter -->
                <div class="dropdown">
                    <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="colorFilter" data-bs-toggle="dropdown" aria-expanded="false">
                        Color
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="colorFilterDropdown">
                        <!-- All Colors Link -->
                        <a class="dropdown-item" th:href="@{/products(sortBy=${param.sortBy}, query=${param.query}, categoryId=${param.categoryId})}">
                            All Colors
                        </a>
        
                        <!-- Loop through colors -->
                        <li th:each="color : ${colors}">
                            <a class="dropdown-item" th:href="@{/products(sortBy=${param.sortBy}, query=${param.query}, categoryId=${param.categoryId}, color=${color})}" th:text="${color}"></a>
                        </li>
                    </ul>
                </div>

            </div>
            <hr>
            <div class="row mb-5" >
                <div class="col-md-3" th:each="product : ${products}">
                    <a th:href="@{/product/{prodId}(prodId=${product.prodId})}" style="text-decoration: none; color: inherit;">
                    <div class="product-card2">
                        <div th:if="${product.images != null and not #lists.isEmpty(product.images)}">
                        <img th:src="@{${product.images[0].imageUrl}}" alt="Best Seller 1" class="img-fluid">
                        </div>
                        <p class="text-center p-2" th:text="${product.prodName}">Product Name</p>
                        <p class="text-center">
                            <span th:if="${product.offerPrice != null}">
                                Price: <s th:text="${product.mrp}">Rs.1800</s> 
                                <span class="text-danger" th:text="${product.offerPrice}">Rs.1620</span>
                            </span>
                            <span th:if="${product.offerPrice == null}">
                                Price: <span class="text-danger" th:text="${product.mrp}">Rs.1800</span>
                            </span>
                        </p>
                    </div>
                    </a>
                    <form th:action="@{/cart/add}" method="post">
                        <input type="hidden" name="productId" th:value="${product.prodId}" />
                        <input type="hidden" name="quantity" value="1" min="1" />
                        <button type="submit" class="btn btn-outline-success d-block mx-auto p-2">Add to Cart</button>
                    </form>                
                </div>            
            </div>
        </section>
    </main>
</body>
</html>